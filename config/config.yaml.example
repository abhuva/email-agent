# V3 Email Processor Configuration
# Copy this file to config.yaml and customize for your setup
# 
# This configuration follows the V3 architecture as specified in pdd.md
# All configuration values can be overridden via environment variables
# Credentials MUST be loaded from environment variables for security

# IMAP Server Configuration
# Connection settings for the email server
imap:
  server: 'imap.example.com'          # IMAP server hostname
  port: 143                            # IMAP port (143 for STARTTLS, 993 for SSL)
  username: 'your-email@example.com'   # Email account username
  password_env: 'IMAP_PASSWORD'        # Environment variable name containing IMAP password
                                       # CRITICAL: Password MUST come from environment variable
  query: 'ALL'                         # IMAP search query (e.g., 'ALL', 'UNSEEN', 'SENTSINCE 01-Jan-2024')
                                       # The processed_tag exclusion is automatically added
  processed_tag: 'AIProcessed'         # IMAP flag name for processed emails
  application_flags:                   # Application-specific flags for cleanup command (Task 13)
    - 'AIProcessed'                    # Flags managed by this application (safe to remove)
    - 'ObsidianNoteCreated'            # These flags can be cleaned up using cleanup-flags command
    - 'NoteCreationFailed'              # Default includes all V1/V2 processing flags

# File and Directory Paths
# All paths relative to project root unless absolute path specified
paths:
  template_file: 'config/note_template.md.j2'  # Jinja2 template for generating Markdown notes
  obsidian_vault: '/path/to/obsidian/vault'    # Obsidian vault directory (must exist)
  log_file: 'logs/agent.log'                   # Unstructured operational log file
  analytics_file: 'logs/analytics.jsonl'        # Structured analytics log (JSONL format)
  changelog_path: 'logs/email_changelog.md'    # Changelog/audit log file
  prompt_file: 'config/prompt.md'              # LLM prompt file for email classification
  summarization_prompt_path: 'config/summarization_prompt.md'  # Optional: Prompt file for summarization

# OpenRouter API Configuration
# Shared settings for OpenRouter API (used by both classification and summarization)
openrouter:
  api_key_env: 'OPENROUTER_API_KEY'   # Environment variable name containing API key
                                      # CRITICAL: API key MUST come from environment variable
  api_url: 'https://openrouter.ai/api/v1'  # OpenRouter API endpoint

# Classification Configuration
# Settings for email classification task (spam/importance scoring)
classification:
  model: 'google/gemini-2.5-flash-lite-preview-09-2025'  # LLM model to use for classification
                                                         # Examples: 'openai/gpt-3.5-turbo', 'anthropic/claude-3-haiku'
  temperature: 0.2                     # LLM temperature (0.0-2.0, lower = more deterministic)
  retry_attempts: 3                     # Number of retry attempts for failed API calls
  retry_delay_seconds: 5                # Initial delay between retries (exponential backoff)

# Summarization Configuration
# Settings for email summarization task (for important emails)
summarization:
  model: 'google/gemini-2.5-flash-lite-preview-09-2025'  # LLM model to use for summarization
                                                         # Can be different from classification model
  temperature: 0.3                     # LLM temperature (0.0-2.0, typically higher for summarization)
  retry_attempts: 3                     # Number of retry attempts for failed API calls
  retry_delay_seconds: 5                # Initial delay between retries (exponential backoff)

# Processing Configuration
# Thresholds and limits for email processing
processing:
  importance_threshold: 8               # Minimum importance score (0-10) to mark email as important
  spam_threshold: 5                     # Maximum spam score (0-10) to consider email as spam
  max_body_chars: 4000                  # Maximum characters to send to LLM (truncates longer emails)
  max_emails_per_run: 15                # Maximum number of emails to process per execution
  # Optional - only if you want summarization
  summarization_tags:
    - 'important'  # Tag generated when importance_score >= threshold

# Environment Variable Overrides
# You can override any config value using environment variables.
# This is useful for deployment-specific settings or secrets.
#
# Naming Convention: EMAIL_AGENT_<SECTION>_<KEY> (uppercase, underscores)
#
# Examples:
#   EMAIL_AGENT_IMAP_SERVER=imap.custom.com
#   EMAIL_AGENT_IMAP_PORT=993
#   EMAIL_AGENT_CLASSIFICATION_MODEL=openai/gpt-4
#   EMAIL_AGENT_CLASSIFICATION_TEMPERATURE=0.3
#   EMAIL_AGENT_SUMMARIZATION_MODEL=anthropic/claude-3-haiku
#   EMAIL_AGENT_SUMMARIZATION_TEMPERATURE=0.4
#   EMAIL_AGENT_PROCESSING_IMPORTANCE_THRESHOLD=7
#   EMAIL_AGENT_PATHS_OBSIDIAN_VAULT=/custom/path/to/vault
#
# Type Conversion:
#   - Integer values are automatically converted (port, thresholds, retry settings)
#   - Float values are automatically converted (temperature)
#   - String values remain as strings
#
# Required Environment Variables (MUST be set for security):
#   - IMAP_PASSWORD: Your IMAP account password (specified in imap.password_env)
#   - OPENROUTER_API_KEY: Your OpenRouter API key (specified in openrouter.api_key_env)
#
# Note: Credentials MUST come from environment variables. The config file only
# specifies which environment variable names to use, not the actual values.
