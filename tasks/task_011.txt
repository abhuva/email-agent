# Task ID: 11
# Title: Update CLI for Multi-Account Support
# Status: done
# Dependencies: 10
# Priority: medium
# Description: Enhance the CLI to support account-specific commands
# Details:
Update the CLI module to support new commands: 'process --account <name>', 'process --all', and 'show-config --account <name>'. Integrate with the MasterOrchestrator for execution. Ensure proper argument validation and help text.

# Test Strategy:
Test each command with various arguments including edge cases like invalid account names. Verify proper integration with the MasterOrchestrator.

# Subtasks:
## 1. Extend CLI argument parsing to support new multi-account flags [done]
### Dependencies: None
### Description: Add and wire up the new CLI options `process --account <name>`, `process --all`, and `show-config --account <name>` in the existing CLI module.
### Details:
Identify where CLI commands and flags are currently defined (e.g., argparse/Click/subcommand registry) and extend the `process` and `show-config` commands to accept the new flags.
- For `process`, add mutually exclusive options `--account <name>` and `--all` alongside any existing options.
- For `show-config`, add the `--account <name>` option.
- Ensure the parsed arguments structure (e.g., options object) includes fields for `accountName`, `allAccounts`, etc., that can be consumed downstream.
- Update any command routing or dispatch switch statements so that invocations including these options reach the appropriate handler functions without changing behavior of existing commands.

## 2. Implement argument validation rules for account-related options [done]
### Dependencies: 11.1
### Description: Define and enforce validation rules for the new account-related flags to ensure correct and unambiguous CLI usage.
### Details:
Implement validation logic that runs immediately after parsing and before invoking business logic.
- Enforce that `process` must receive exactly one of: `--account <name>` or `--all`, and fail with a clear error message if neither or both are provided.
- For `show-config`, require `--account <name>` if that is mandatory, or define precedence with existing options if not.
- Validate that `<name>` is non-empty and adheres to any existing account naming rules (e.g., allowed characters, length); centralize these checks in a helper function for reuse.
- Ensure validation errors exit with a non-zero status code and print concise, user-friendly messages that indicate the invalid combination and how to fix it.
- Add unit tests (or extend existing ones) to cover valid and invalid combinations of the new flags.

## 3. Integrate account-aware commands with MasterOrchestrator [done]
### Dependencies: 11.1, 11.2
### Description: Connect the new CLI command variants to the MasterOrchestrator so that account-specific and all-account processing is executed correctly.
### Details:
Update the command handlers to call the MasterOrchestrator with the appropriate parameters derived from the parsed and validated arguments.
- For `process --account <name>`, call a MasterOrchestrator method that processes a single account (e.g., `orchestrator.processAccount(accountName)`), adding such a method if it does not exist yet.
- For `process --all`, call a method that loops through all known accounts (e.g., `orchestrator.processAllAccounts()`), implemented either directly in MasterOrchestrator or as a helper that enumerates available accounts and invokes the per-account logic.
- For `show-config --account <name>`, invoke a MasterOrchestrator (or related service) method to fetch and display that account’s configuration.
- Ensure that orchestration errors are surfaced to the CLI with proper exit codes and messages while not leaking internal stack traces in normal error output.
- Add tests (or integration-style checks) to verify that the correct MasterOrchestrator methods are invoked for each flag combination.

## 4. Update and refine CLI help text and usage documentation [done]
### Dependencies: 11.1, 11.2, 11.3
### Description: Improve the CLI help output and related in-tool documentation to clearly describe the new multi-account options and their usage patterns.
### Details:
Modify the help/usage strings associated with the `process` and `show-config` commands.
- For `process`, document the purpose of `--account <name>` and `--all`, including that they are mutually exclusive and at least one is required, with concrete examples.
- For `show-config`, document how `--account <name>` works and what information is shown.
- Ensure the global `--help` output and any command-specific `--help` reflect the new options and validation rules.
- If there is separate README or CLI reference documentation in the repo, update it to include example invocations and explain common workflows (single account vs all accounts).

## 5. Add comprehensive tests and perform regression verification [done]
### Dependencies: 11.1, 11.2, 11.3, 11.4
### Description: Create or extend automated tests to cover new behaviors and verify that existing CLI functionality remains unaffected.
### Details:
Implement test cases for the new multi-account commands using the project’s existing testing framework.
- Add tests for `process --account <name>` and `process --all`, ensuring correct argument parsing, validation, orchestration calls, and exit codes.
- Add tests for `show-config --account <name>`, verifying correct parsing and that the configuration for the specified account is retrieved and displayed.
- Include negative tests for invalid flag combinations and missing required options, asserting the exact error messages and non-zero exit codes.
- Run the full test suite (and any available CLI integration tests) to confirm no regressions in existing commands.
- Adjust or add mocks/stubs for MasterOrchestrator as necessary to isolate CLI behavior in the tests.

## 6. Final stage: Validate tests, update documentation, review rules, mark done, and commit [done]
### Dependencies: 11.1, 11.2, 11.3, 11.4, 11.5
### Description: MANDATORY final stage: Run tests, update documentation, review for rule learnings, mark task done in Task Master, and commit all changes.
### Details:
1) Run full test suite: pytest -v and ensure all tests pass (new and existing). Fix any failing tests before proceeding.
2) Update/create module documentation in docs/ directory following documentation.mdc guidelines. Update docs/MAIN_DOCS.md if adding new documentation. Reference relevant PDD sections.
3) Review code for patterns that should be captured in rules (see .cursor/rules/self_improve.mdc). Add new rules if: new technology/pattern used in 3+ files, common bugs could be prevented, or new best practices emerged. Update existing rules if better examples exist.
4) Mark task done in Task Master: task-master set-status --id=11 --status=done
5) Commit tasks.json: git add tasks/tasks.json && git commit -m "chore(tasks): Mark task 11 complete"
6) Commit all changes: git add . && git commit -m "feat(module): Task 11 - Update CLI for Multi-Account Support [docs]"
This workflow is MANDATORY and must not be skipped. See .cursor/rules/task_completion_workflow.mdc for details.

