# Task ID: 11
# Title: Update analytics tracking system
# Status: pending
# Dependencies: 9
# Priority: low
# Description: Enhance the analytics system to track new metrics for note creation and summarization
# Details:
Update the analytics tracking to include new metrics: notes_created, summaries_generated, and note_creation_failures. Modify the JSON schema and file writing logic to include these new fields. Ensure backward compatibility with existing analytics files.

# Test Strategy:
Test analytics recording with various processing scenarios. Verify the JSON structure is correct and all metrics are accurately tracked. Test with existing analytics files to ensure backward compatibility.

# Subtasks:
## 1. Update JSON schema to include new metrics [pending]
### Dependencies: None
### Description: Modify the existing JSON schema definition to add the new fields: notes_created, summaries_generated, and note_creation_failures as optional integer fields.
### Details:
Locate the JSON schema file (likely schema.json or similar in the analytics module). Add the new properties under the root object with type: 'integer', default: 0, and description for each. Use 'required' array exclusion to ensure backward compatibility. Validate the updated schema using a JSON schema validator tool.

## 2. Update analytics data collection logic [pending]
### Dependencies: 11.1
### Description: Modify the code responsible for collecting and populating analytics data to increment the new metrics: notes_created on successful note creation, summaries_generated on successful summarization, and note_creation_failures on note creation errors.
### Details:
Identify event handlers for note creation, summarization success/failure (likely in services like NoteService or AnalyticsTracker). Use atomic counters (e.g., Redis increment or in-memory with locks) to track per-session or global counts. Initialize new fields to 0 if absent in existing data objects. Add unit tests for each increment scenario.

## 3. Modify file writing logic for new schema [pending]
### Dependencies: 11.1, 11.2
### Description: Update the JSON serialization and file append/write logic to include the new fields while preserving backward compatibility with existing analytics files.
### Details:
In the file writer (likely AnalyticsFileWriter class), ensure JSON marshal/unmarshal handles optional fields gracefully. When reading existing files, merge new fields with default 0 values. When writing, always include all fields. Use json.MarshalIndent for consistent formatting. Test with mixed old/new data files.

## 4. Add comprehensive unit and integration tests [pending]
### Dependencies: 11.1, 11.2, 11.3
### Description: Create tests to verify new metrics tracking, schema validation, file compatibility, and edge cases like failures and zero values.
### Details:
Write unit tests for data collection increments, schema validation, and file I/O. Create integration tests simulating note creation/summarization flows with mock failures. Test reading/writing mixed files. Use test fixtures with real old analytics files. Aim for 90%+ code coverage on modified paths.

## 5. Perform end-to-end testing and deployment validation [pending]
### Dependencies: 11.1, 11.2, 11.3, 11.4
### Description: Run full system tests, validate backward compatibility with production files, and deploy with monitoring.
### Details:
Test in staging: generate notes/summaries, trigger failures, verify metrics in output files. Backup production analytics files, deploy incrementally, monitor file writes for errors. Validate old files remain readable. Add logging for new metrics. Roll back plan if compatibility issues detected.

